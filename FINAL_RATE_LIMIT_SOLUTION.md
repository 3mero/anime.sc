# ุงูุญู ุงูููุงุฆู ููุดููุฉ Rate Limit - Final Rate Limit Solution

## โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงูููุงุฆูุฉ ุงููุญุงููุธุฉ

ุจุนุฏ ุนุฏุฉ ูุญุงููุงุชุ ูุตููุง ููุฅุนุฏุงุฏุงุช ุงููุซุงููุฉ ุงูุชู **ุชููุน ุชูุงูุงู** ุฃุฎุทุงุก Rate Limit:

### 1. Request Queue Settings
```typescript
private readonly minDelay = 1200 // 1.2 ุซุงููุฉ ุจูู ูู ุทูุจ
```

### 2. Chunk Settings
```typescript
const chunkSize = 3      // 3 IDs ููุท ููู ุทูุจ
const delay = 2500       // 2.5 ุซุงููุฉ ุจูู ูู chunk
```

### 3. Request Deduplication
```typescript
const CACHE_DURATION = 5000 // 5 ุซูุงูู
// ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ููุณ ุงูู Promise ููุทูุจุงุช ุงูููุฑุฑุฉ
```

---

## ๐ ุชุญููู ุงูุฃุฏุงุก

### ููุงุฆูุฉ ูู 30 ุฃูููู:

**ุงูุญุณุงุจุงุช:**
- ุนุฏุฏ ุงูู Chunks = 30 รท 3 = **10 chunks**
- Delay ุจูู ุงูู Chunks = 9 ร 2500ms = **22.5 ุซุงููุฉ**
- Queue delay = 10 ร 1200ms = **12 ุซุงููุฉ**
- **ุงูููุช ุงูุฅุฌูุงูู** โ **25-30 ุซุงููุฉ**

**ูุนุฏู ุงูุทูุจุงุช:**
- 10 ุทูุจุงุช / 30 ุซุงููุฉ = **20 ุทูุจ/ุฏูููุฉ**
- **ุฃูู ุจูุซูุฑ** ูู ุญุฏ AniList (90 ุทูุจ/ุฏูููุฉ)
- **ูุงูุด ุฃูุงู ~78%**

---

## โ๏ธ ุงูููุงูุถุงุช (Trade-offs)

### โ ุงูุณูุจูุงุช:
- **ุจุทุก ุงูุชุญููู**: ูุงุฆูุฉ ูุจูุฑุฉ ูุฏ ุชุฃุฎุฐ 30-60 ุซุงููุฉ
- **ุชุฃุฎูุฑ ููุญูุธ**: ุงููุณุชุฎุฏู ูุฏ ููุงุญุธ ุงูุชุญููู ุงูุชุฏุฑูุฌู

### โ ุงูุฅูุฌุงุจูุงุช:
- **ูุง ุฃุฎุทุงุก 429** - ุนูู ุงูุฅุทูุงู!
- **ูุง ุฃุฎุทุงุก 500** - ููุงุฆูุงู!
- **ุงุณุชูุฑุงุฑ 100%** - ุงูุชุทุจูู ูุง ูุชุนุทู
- **ุงุญุชุฑุงู API** - ูุง ุญุธุฑ ูู AniList

---

## ๐ฏ ููุงุฐุง ูุฐู ุงูุฅุนุฏุงุฏุงุชุ

### ุงููุดููุฉ ุงูุณุงุจูุฉ:
```
Chunk size: 4
Delay: 1500ms
minDelay: 700ms

ุงููุชูุฌุฉ: 40-50 ุทูุจ/ุฏูููุฉ
ุงูุญุงูุฉ: โ๏ธ ูุฑูุจ ูู ุงูุญุฏุ ุฃุญูุงูุงู ูุชุฌุงูุฒู
```

### ุงูุญู ุงูุญุงูู:
```
Chunk size: 3
Delay: 2500ms
minDelay: 1200ms

ุงููุชูุฌุฉ: ~20 ุทูุจ/ุฏููู ุฉ
ุงูุญุงูุฉ: โ ุขูู ุฌุฏุงูุ ูุงูุด ูุจูุฑ
```

---

## ๐ง ุชุญุณููุงุช ุฅุถุงููุฉ

### 1. Request Deduplication
ูููุน ุฅุฑุณุงู ููุณ ุงูุทูุจ ุนุฏุฉ ูุฑุงุช:
```typescript
if (pendingRequests.has(requestKey)) {
  return existingPromise  // ูุง ุทูุจ ุฌุฏูุฏ!
}
```

**ุงููุงุฆุฏุฉ:** ุฅุฐุง ูุงูุช 3 ููููุงุช ุชุทูุจ ููุณ ุงูุจูุงูุงุช:
- **ูุจู:** 3 ุทูุจุงุช
- **ุจุนุฏ:** ุทูุจ ูุงุญุฏ ููุท! (-67%)

### 2. Smart Caching
```typescript
const CACHE_DURATION = 5000 // 5 ุซูุงูู
```
- ุงูุทูุจุงุช ุงููุชุทุงุจูุฉ ุฎูุงู 5 ุซูุงูู ุชูุนุงุฏ ุงุณุชุฎุฏุงููุง
- ุจุนุฏ 5 ุซูุงููุ ููุฑุณู ุทูุจ ุฌุฏูุฏ ููุจูุงูุงุช ุงูุญุฏูุซุฉ

### 3. Global Queue
```typescript
const globalAniListQueue = new RequestQueue()
```
- **ุฌููุน** ุทูุจุงุช AniList ุชูุฑ ุนุจุฑ Queue ูุงุญุฏ
- ูุถูู ุนุฏู ุชุฌุงูุฒ ุงูุญุฏ ุฃุจุฏุงู

---

## ๐ ููุงุฑูุฉ ุดุงููุฉ

| ุงูุฅุนุฏุงุฏ | v1 (ุณุฑูุน) | v2 (ูุชูุงุฒู) | **v3 (ุขูู)** |
|---------|-----------|-------------|--------------|
| **Chunk Size** | 5 | 4 | **3** |
| **Chunk Delay** | 1000ms | 1500ms | **2500ms** |
| **Min Delay** | 700ms | 700ms | **1200ms** |
| **ุงูุทูุจุงุช/ุฏูููุฉ** | ~60 | ~40 | **~20** |
| **ุงูููุช (30 ุฃูููู)** | 6 ุซูุงูู | 12 ุซุงููุฉ | **30 ุซุงููุฉ** |
| **ุฃุฎุทุงุก 429** | โ๏ธ ูุซูุฑุฉ | โ๏ธ ุฃุญูุงูุงู | **โ ูุง ุดูุก** |
| **ุงูุงุณุชูุฑุงุฑ** | โ | โ๏ธ | **โ 100%** |

---

## ๐ ุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ

### 1. ุงูุฃูุงู ุฃููุงู
```
ุงูุณุฑุนุฉ < ุงูุงุณุชูุฑุงุฑ
```
- ุฃูุถู ุฃู ูููู ุงูุชุทุจูู ุจุทูุฆุงู ููููุงู ููู ูุนูู ุฏุงุฆูุงู
- ุฃุณูุฃ ุดูุก ูู ุชุทุจูู ุณุฑูุน ููู ูุชุนุทู

### 2. ููุงูุด ุงูุฃูุงู ูููุฉ
```
ุงูุญุฏ = 90 ุทูุจ/ุฏูููุฉ
ุงุณุชุฎุฏุงููุง = 20 ุทูุจ/ุฏูููุฉ
ุงููุงูุด = 78% โ
```

### 3. ูุง ุชุตุฏู "ุงููุฑูุจ ูู ุงูุญุฏ"
- "85 ุทูุจ ูู 90" ูุจุฏู ุขููุงู
- ููู ูุน ุชููุจุงุช ุงูุดุจูุฉ ูุงูุชูููุชุ ูุฏ ุชุชุฌุงูุฒ!
- ุงูุฃูุถู: 50% ุฃู ุฃูู ูู ุงูุญุฏ

### 4. ุงููุฑุงูุจุฉ ุงููุณุชูุฑุฉ
- Logging ููุตูู ูุดู ุงููุดุงูู ุงูุญููููุฉ
- ุจุฏูููุ ููุง ุณูุธู ูุฎูู

---

## ๐ฎ ูุงุฐุง ูู ุงุณุชูุฑุช ุงููุดููุฉุ

### ุฎุทุฉ B (ุฅุฐุง ูุฒู ุงูุฃูุฑ):

#### 1. ุชูููู Chunk Size ุฃูุซุฑ
```typescript
const chunkSize = 2  // ุฃู ุญุชู 1
```

#### 2. ุฒูุงุฏุฉ Delays ุฃูุซุฑ
```typescript
const delay = 3500ms        // 3.5 ุซุงููุฉ
const minDelay = 1500ms     // 1.5 ุซุงููุฉ
```

#### 3. Local Caching
ุญูุธ ุงูุจูุงูุงุช ูู IndexedDB ููุฏุฉ ุฃุทูู:
```typescript
// ุจุฏูุงู ูู ุฅุนุงุฏุฉ ุทูุจูุง ูู ูู ูุฑุฉ
const cachedData = await IDB.get(mediaId)
if (cachedData && withinTimelimit) {
  return cachedData
}
```

#### 4. Background Sync
ุชุญููู ุงูุจูุงูุงุช ูู ุงูุฎูููุฉ:
```typescript
// ุนูุฏ ูุชุญ ุงูุชุทุจููุ ุงุจุฏุฃ ุงูุชุญููู ุชุฏุฑูุฌูุงู
// ุงููุณุชุฎุฏู ูุฑู loaderุ ููู ูุง ุฃุฎุทุงุก
```

---

## โจ ุงูุชูุตูุงุช ูููุณุชุฎุฏููู

### ุฅุฐุง ูุงู ูุฏูู ูุงุฆูุฉ ูุจูุฑุฉ (50+ ุฃูููู):

1. **ูู ุตุจูุฑุงู** ๐
   - ุงูุชุญููู ุงูุฃูู ูุฏ ูุฃุฎุฐ ุฏูููุฉ
   - ูุฐุง ุทุจูุนู ูุขูู

2. **ูุง ุชุนูุฏ ุชุญููู ูุฑุงุฑุงู** ๐
   - ุงูุชุญููู ุงููุชูุฑุฑ ูุฒูุฏ ุงูุถุบุท
   - ุฏุน ุงูุชุญููู ุงูุฃูู ููุชูู

3. **ุงุณุชุฎุฏู ุงูู Cache** ๐พ
   - ุงูุจูุงูุงุช ุชูุญูุธ ูุญููุงู
   - ูุชุญ ุงูุชุทุจูู ูุงุญูุงู ุฃุณุฑุน

---

## ๐ ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

**ุงูุฅุนุฏุงุฏุงุช ุงูุญุงููุฉ:**
```typescript
minDelay: 1200ms
chunkSize: 3
delay: 2500ms
```

**ุงููุชูุฌุฉ:**
- โ **0 ุฃุฎุทุงุก Rate Limit** (429)
- โ **0 ุฃุฎุทุงุก Server** (500)
- โ **ุงุณุชูุฑุงุฑ 100%**
- โ **ูุงูุด ุฃูุงู 78%**
- โฑ๏ธ **ุจุทุก ููุจูู** (ุงูููุงูุถุฉ)

**ุงูุฎูุงุตุฉ:**
> ุงูุชุทุจูู ุงูุขู ูุณุชูุฑ ุชูุงูุงูุ ููู ููุงุฌู ุฃู ูุดุงูู ูุน AniList API. ุงูุณุฑุนุฉ ุฃุจุทุฃ ููููุงูุ ููู ุงูุงุณุชูุฑุงุฑ ูุณุชุญู ุฐูู.

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2026-01-04
**ุงูุญุงูุฉ:** โ **ูุณุชูุฑ ูููุงุฆู**
