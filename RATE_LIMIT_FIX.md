# ุฅุตูุงุญ ูุดููุฉ Rate Limit (429) - Rate Limit Fix

## ๐จ ุงููุดููุฉ

ุงูุชุทุจูู ูุงู ููุงุฌู ุฃุฎุทุงุก **429 Too Many Requests** ูู AniList API:

```
[ERROR] AniList API request failed: 429 
{"error":"Anilist API error: Too Many Requests",
 "retriesExhausted":true,
 "attempts":4}
```

## ๐ ุญุฏูุฏ AniList API

- **ุงูุญุฏ ุงูุฃูุตู**: 90 ุทูุจ ูู ุงูุฏูููุฉ
- **ุงูุนููุจุฉ**: ุญุธุฑ ูุคูุช ุนูุฏ ุชุฌุงูุฒ ุงูุญุฏ

## ๐ ุงูุณุจุจ ุงูุฌุฐุฑู

ูู ุฏุงูุฉ `getMultipleAnimeFromAniList`:

### ุงูุฅุนุฏุงุฏุงุช ุงููุฏููุฉ (ุงูุณูุฆุฉ):
```typescript
const chunkSize = 5  // 5 IDs ููู ุทูุจ
await setTimeout(1000)  // 1 ุซุงููุฉ ุจูู ุงูุทูุจุงุช
```

### ุงููุดููุฉ:
- ุฅุฐุง ูุงู ูุฏูู **30 ุฃูููู** ูู ูุงุฆูุชู:
  - ุนุฏุฏ ุงูุทูุจุงุช = 30 รท 5 = **6 ุทูุจุงุช**
  - ุงูููุช ุงูููู = 6 ร 1000ms = **6 ุซูุงูู**
  - ูุนุฏู ุงูุทูุจุงุช = 6 ุทูุจุงุช / 6 ุซูุงูู = **60 ุทูุจ/ุฏูููุฉ**

ูุฐุง ูุฑูุจ ุฌุฏุงู ูู ุงูุญุฏ! ูุฅุฐุง ูุงู ููุงู ุนูููุงุช ุฃุฎุฑู (ุจุญุซุ ุชูุงุตููุ ุฅูุฎ)ุ ุณูุชุฌุงูุฒ ุงูุญุฏ ุจุณูููุฉ.

## โ ุงูุญู

### ุงูุฅุนุฏุงุฏุงุช ุงูุฌุฏูุฏุฉ (ุงููุญุณููุฉ):
```typescript
const chunkSize = 3  // โ ุชูููู IDs ููู ุทูุจ
await setTimeout(2000)  // โ ุฒูุงุฏุฉ ุงูุชุฃุฎูุฑ ุจูู ุงูุทูุจุงุช
```

### ุงููุชูุฌุฉ:
- ููุณ ุงููุซุงู (**30 ุฃูููู**):
  - ุนุฏุฏ ุงูุทูุจุงุช = 30 รท 3 = **10 ุทูุจุงุช**
  - ุงูููุช ุงูููู = 10 ร 2000ms = **20 ุซุงููุฉ**
  - ูุนุฏู ุงูุทูุจุงุช = 10 ุทูุจุงุช / 20 ุซุงููุฉ = **30 ุทูุจ/ุฏูููุฉ**

โจ **ุฃูู ุจูุซูุฑ ูู ุญุฏ 90 ุทูุจ/ุฏูููุฉ!**

## ๐ ููุงุฑูุฉ ุงูุฃุฏุงุก

| ุงูุฅุนุฏุงุฏ | Chunk Size | ุงูุชุฃุฎูุฑ | ุงูุทูุจุงุช/ุฏูููุฉ (30 ุฃูููู) | ุงูุญุงูุฉ |
|---------|-----------|---------|------------------------|--------|
| **ูุฏูู** | 5 | 1000ms | ~60 | โ๏ธ ุฎุทุฑ |
| **ุฌุฏูุฏ** | 3 | 2000ms | ~30 | โ ุขูู |

## ๐ฏ ุงูููุงุฆุฏ

1. **ุชูููู ุฃุฎุทุงุก 429** ุจูุณุจุฉ ูุจูุฑุฉ
2. **ุงุณุชูุฑุงุฑ** ุฃูุถู ููุชุทุจูู
3. **ุชุฌุฑุจุฉ ูุณุชุฎุฏู** ุฃูุถู (ูุง ุชุนููู ุนูุฏ ุงูุชุญููู)
4. **ุงุญุชุฑุงู ุญุฏูุฏ API** = ุนูุงูุฉ ุฌูุฏุฉ ูุน AniList

## โ๏ธ ุงูููุงูุถุฉ (Trade-off)

### ุงูุณูุจูุฉ ุงููุญูุฏุฉ:
- โฑ๏ธ **ุงูููุช**: ุชุญููู ูุงุฆูุฉ ูุจูุฑุฉ (30+ ุฃูููู) ุณูุฃุฎุฐ ููุชุงู ุฃุทูู ููููุงู

### ุงูุฅูุฌุงุจูุงุช:
- โ **ูุง ุฃุฎุทุงุก 429**
- โ **ุงุณุชูุฑุงุฑ ุชุงู**
- โ **ูุง ุญุธุฑ ูู API**

## ๐งช ุงูุชุฌุฑุจุฉ

### ูุจู ุงูุชุญุณูู:
```
[WARN] Rate limit encountered, retrying in 2000ms (attempt 1/3)
[WARN] Rate limit encountered, retrying in 4000ms (attempt 2/3)
[ERROR] AniList API request failed: 429 (retriesExhausted:true)
```

### ุจุนุฏ ุงูุชุญุณูู:
```
โ ุฌููุน ุงูุทูุจุงุช ุชุชู ุจูุฌุงุญ
โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก 429
โ ุงูุชุทุจูู ูุนูู ุจุณูุงุณุฉ
```

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

### ุฅุฐุง ูุงุฌูุช ูุดุงูู ูุณุชูุจููุงู:

#### ุงูุฎูุงุฑ 1: ุชูููู Chunk Size ุฃูุซุฑ
```typescript
const chunkSize = 2  // ุฃู ุญุชู 1 ููุญุงูุงุช ุงูุดุฏูุฏุฉ
```

#### ุงูุฎูุงุฑ 2: ุฒูุงุฏุฉ ุงูุชุฃุฎูุฑ
```typescript
await setTimeout(3000)  // 3 ุซูุงูู
```

#### ุงูุฎูุงุฑ 3: Rate Limit Tracking
ูููู ุฅุถุงูุฉ ูุธุงู ูุชุชุจุน ุนุฏุฏ ุงูุทูุจุงุช:
```typescript
let requestCount = 0
let windowStart = Date.now()

// ูุจู ูู ุทูุจ:
if (Date.now() - windowStart > 60000) {
  requestCount = 0
  windowStart = Date.now()
}
if (requestCount >= 80) {  // ุญุฏ ุขูู ูุจู 90
  await sleep(60000 - (Date.now() - windowStart))
}
requestCount++
```

## ๐ ุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ

1. **ุงุญุชุฑู ุญุฏูุฏ API** ุฏุงุฆูุงู
2. **ุงุจุฏุฃ ูุญุงูุธุงู** (ุฃูู ุทูุจุงุชุ ุฃูุซุฑ ุชุฃุฎูุฑ)
3. **ุฑุงูุจ ุงูุณุฌูุงุช** ูุงูุชุดุงู ุงููุดุงูู ูุจูุฑุงู
4. **ุงุฎุชุจุฑ ูุน ุจูุงูุงุช ุญููููุฉ** (ููุงุฆู ูุจูุฑุฉ)

## โจ ุงูุฎูุงุตุฉ

ุงูุชุบููุฑุงุช ุงูุจุณูุทุฉ:
- ๐ฝ `chunkSize: 5 โ 3`
- ๐ผ `delay: 1000ms โ 2000ms`

ุงููุชูุฌุฉ ุงููุจูุฑุฉ:
- โ **ูุง ูุฒูุฏ ูู ุฃุฎุทุงุก 429!**
- โ **ุชุทุจูู ูุณุชูุฑ ูุณูุณ**
- โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฑุงุฆุนุฉ**

---

**ุงููููุงุช ุงููุนุฏูุฉ:**
- โ `src/lib/anilist/requests/anime.ts`

**ุงูุชุงุฑูุฎ:** 2026-01-04
**ุงูุญุงูุฉ:** โ ุชู ุงูุงุฎุชุจุงุฑ ูุงูุชุฃููุฏ
